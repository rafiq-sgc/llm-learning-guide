<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Prompt Engineering (Get Better Results) - Comprehensive LLM Guide</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ§© Advanced Prompt Engineering</h1>
            <p class="subtitle">Chapter 25 of 26 - Comprehensive Guide</p>
        </header>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle menu">â˜°</button>

        <nav class="nav-sidebar" id="nav-sidebar">
            <ul>
                <li><a href="comprehensive_index.html">ğŸ  Home</a></li>
                <li><a href="comprehensive_chapter1.html">ğŸ¤– Chapter 1: Introduction to AI</a></li>
                <li><a href="comprehensive_chapter2.html">ğŸ“Š Chapter 2: Machine Learning</a></li>
                <li><a href="comprehensive_chapter3.html">ğŸ§  Chapter 3: Deep Learning</a></li>
                <li><a href="comprehensive_chapter4.html">ğŸ”— Chapter 4: Neural Networks</a></li>
                <li><a href="comprehensive_chapter5.html">ğŸ’¬ Chapter 5: NLP Evolution</a></li>
                <li><a href="comprehensive_chapter6.html">âš¡ Chapter 6: Transformers</a></li>
                <li><a href="comprehensive_chapter7.html">ğŸ“ Chapter 7: LLM Training</a></li>
                <li><a href="comprehensive_chapter8.html">ğŸ—ï¸ Chapter 8: LLM Architecture</a></li>
                <li><a href="comprehensive_chapter9.html">ğŸ”„ Chapter 9: Query Processing</a></li>
                <li><a href="comprehensive_chapter10.html">ğŸ‘ï¸ Chapter 10: Attention</a></li>
                <li><a href="comprehensive_chapter11.html">ğŸ“š Chapter 11: Training Data</a></li>
                <li><a href="comprehensive_chapter12.html">ğŸ¯ Chapter 12: Fine-tuning</a></li>
                <li><a href="comprehensive_chapter13.html">âš™ï¸ Chapter 13: Inference</a></li>
                <li><a href="comprehensive_chapter14.html">ğŸ“ˆ Chapter 14: Evolution</a></li>
                <li><a href="comprehensive_chapter15.html">ğŸš€ Chapter 15: Applications</a></li>
                <li><a href="comprehensive_chapter16.html">ğŸ”¤ Chapter 16: Tokenization</a></li>
                <li><a href="comprehensive_chapter17.html">ğŸ§® Chapter 17: Embeddings</a></li>
                <li><a href="comprehensive_chapter18.html">ğŸ”— Chapter 18: Tokenization vs Embeddings</a></li>
                <li><a href="comprehensive_chapter19.html">ğŸ­ Chapter 19: End-to-End LLM Lifecycle</a></li>
                <li><a href="comprehensive_chapter20.html">ğŸ² Chapter 20: How LLMs Generate Text</a></li>
                <li><a href="comprehensive_chapter21.html">ğŸ§  Chapter 21: How LLMs Understand Meaning</a></li>
                <li><a href="comprehensive_chapter22.html">ğŸ§ª Chapter 22: Training Recipe (Step-by-Step)</a></li>
                <li><a href="comprehensive_chapter23.html">ğŸ‘ï¸ Chapter 23: How Multimodal LLMs â€œSeeâ€</a></li>
                <li><a href="comprehensive_chapter24.html">ğŸ—„ï¸ Chapter 24: NL2SQL Deep Dive</a></li>
                <li><a href="comprehensive_chapter25.html" class="active">ğŸ§© Chapter 25: Advanced Prompt Engineering</a></li>
                <li><a href="comprehensive_chapter26.html">ğŸ§¯ Chapter 26: Failures, Why, and Fixes</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="chapter-header">
                <h1>ğŸ§© Chapter 25: Advanced Prompt Engineering (Better Results)</h1>
                <p>Practical techniques to increase accuracy, reduce hallucinations, improve consistency, and make outputs production-ready.</p>
            </div>

            <div class="chapter-nav">
                <a href="comprehensive_chapter24.html">â† Previous Chapter</a>
                <a href="comprehensive_index.html">ğŸ  Home</a>
                <a href="comprehensive_chapter26.html">Next Chapter â†’</a>
            </div>

            <div class="section">
                <h2>Prompt Engineering = Controlling Inputs to Control Outputs</h2>
                <p><strong>Think like a software engineer:</strong> a prompt is an API contract. Better prompts reduce ambiguity and constrain failure modes.</p>

                <div class="diagram-section">
                    <div class="diagram-explanation">
                        <h4>ğŸ›ï¸ What you control</h4>
                        <p>Quality improves when you control objective, context, constraints, and verification.</p>
                    </div>
                    <div class="diagram-container">
                        <div class="mermaid">
flowchart LR
    A[Goal / Task] --> P[Prompt]
    B[Context / Grounding] --> P
    C[Constraints / Format] --> P
    D[Examples] --> P
    P --> M[Model]
    M --> O[Output]
    O --> V[Verify / Validate]
    V -->|Fail| R[Repair / Retry]
    V -->|Pass| S[Ship result]

    style P fill:#fff3e0
    style V fill:#f3e5f5
    style S fill:#e8f5e9
                        </div>
                    </div>
                </div>

                <h2>Technique 1: Give the Model a Role + Objective + Audience</h2>
                <div class="example-box">
                    <h4>âœ… Pattern</h4>
                    <pre><code>Role: You are a senior backend engineer.
Objective: Produce a safe, correct SQL query and a short explanation.
Audience: Other engineers who will review it.</code></pre>
                </div>

                <h2>Technique 2: Provide Grounding (Context that the model must use)</h2>
                <p>Grounding reduces hallucination. Examples:</p>
                <ul>
                    <li><strong>Schema</strong> (NL2SQL)</li>
                    <li><strong>Docs snippets</strong> (API usage)</li>
                    <li><strong>Policies</strong> (what to refuse)</li>
                    <li><strong>Examples</strong> (style and structure)</li>
                </ul>

                <div class="example-box success-box">
                    <h4>âœ… Grounded NL2SQL prompt snippet</h4>
                    <pre><code>SCHEMA:
students(id, name, gpa, enrollment_year, graduated_at)
RULES:
- Use only columns from SCHEMA
- Output PostgreSQL SQL only
QUESTION:
"Top 5 students by GPA in 2024 excluding graduates"</code></pre>
                </div>

                <h2>Technique 3: Output Contracts (Structured Output)</h2>
                <p>For production, always request a strict format (SQL-only, JSON-only). Then validate it.</p>
                <div class="example-box">
                    <h4>ğŸ“¦ JSON contract example</h4>
                    <pre><code>Return JSON:
{
  "sql": "...",
  "assumptions": ["..."],
  "safety": {"read_only": true},
  "confidence": 0.0
}</code></pre>
                </div>

                <h2>Technique 4: Few-shot Examples (Show, donâ€™t just tell)</h2>
                <p>Few-shot works best when examples match your real distribution (schema style, join patterns, business terminology).</p>
                <div class="example-box">
                    <h4>âœ… Few-shot pattern (NL2SQL)</h4>
                    <pre><code>Example 1:
Q: "Students enrolled in 2024"
SQL: SELECT ... WHERE enrollment_year = 2024;

Example 2:
Q: "Top 3 students by GPA excluding graduates"
SQL: SELECT ... WHERE graduated_at IS NULL ORDER BY gpa DESC LIMIT 3;</code></pre>
                </div>

                <h2>Technique 5: Decompose the Task (Plan â†’ Execute)</h2>
                <p>Break complex tasks into explicit sub-steps. For example, for NL2SQL:</p>
                <ul>
                    <li><strong>Step A</strong>: identify entities/metrics/filters</li>
                    <li><strong>Step B</strong>: map entities to schema</li>
                    <li><strong>Step C</strong>: generate SQL</li>
                    <li><strong>Step D</strong>: self-check against schema</li>
                </ul>

                <div class="diagram-section">
                    <div class="diagram-container">
                        <div class="mermaid">
flowchart TD
    Q[Question] --> A[Extract intent<br/>entities, metrics, filters]
    A --> B[Schema linking<br/>tables, columns, joins]
    B --> C[Generate draft SQL]
    C --> D[Self-check<br/>columns exist? joins correct?]
    D --> E{Pass?}
    E -->|No| C
    E -->|Yes| Out[Return final SQL]

    style Q fill:#e3f2fd
    style D fill:#fff3e0
    style Out fill:#e8f5e9
                        </div>
                    </div>
                </div>

                <h2>Technique 6: Add Guardrails (Hard Constraints)</h2>
                <ul>
                    <li><strong>Allowed operations</strong>: SELECT-only</li>
                    <li><strong>Limits</strong>: enforce LIMIT / prevent full scans</li>
                    <li><strong>Forbidden columns</strong>: block PII</li>
                    <li><strong>Dialect</strong>: PostgreSQL / MySQL / BigQuery fixed</li>
                </ul>

                <h2>Technique 7: Retrieval-Augmented Generation (RAG)</h2>
                <p>When the answer depends on external knowledge (docs, tickets, schemas), retrieve relevant chunks and include them as context.</p>
                <div class="example-box">
                    <h4>ğŸ“Œ RAG prompt skeleton</h4>
                    <pre><code>QUESTION: ...
CONTEXT (retrieved):
1) ...
2) ...
INSTRUCTIONS:
- Answer using ONLY the context
- If missing, say "Not found in context"</code></pre>
                </div>

                <h2>Technique 8: Self-Verification (Ask it to check itself)</h2>
                <p>Ask for an explicit checklist and verification, then reject if it fails. (In production you do this with code validators too.)</p>
                <div class="example-box warning-box">
                    <h4>âš ï¸ Self-check checklist example (NL2SQL)</h4>
                    <pre><code>Before final SQL:
- Verify every column exists in schema
- Verify joins use FK relationships
- Ensure query is SELECT-only
- Ensure a LIMIT is present (if result can be large)</code></pre>
                </div>

                <h2>Technique 9: Use a â€œRepair Loopâ€ with Real Feedback</h2>
                <p>The best improvements come from real error messages: SQL parse errors, DB errors, unit test failures.</p>
                <div class="example-box success-box">
                    <h4>âœ… Example repair loop input</h4>
                    <pre><code>SQL failed with:
ERROR: column "enrolled_year" does not exist
HINT: Perhaps you meant "enrollment_year"

Fix the SQL using only schema columns.</code></pre>
                </div>

                <h2>Success Points vs Failure Points (Quick Table)</h2>
                <table>
                    <tr>
                        <th>What helps success</th>
                        <th>What causes failure</th>
                        <th>Fix</th>
                    </tr>
                    <tr>
                        <td><strong>Grounding</strong> (schema/docs)</td>
                        <td>Missing context â†’ guessing</td>
                        <td>Add RAG / include schema</td>
                    </tr>
                    <tr>
                        <td><strong>Output contracts</strong> (JSON/SQL-only)</td>
                        <td>Free-form output</td>
                        <td>Constrain + validate</td>
                    </tr>
                    <tr>
                        <td><strong>Few-shot examples</strong></td>
                        <td>Wrong style/dialect</td>
                        <td>Add representative examples</td>
                    </tr>
                    <tr>
                        <td><strong>Verification loop</strong></td>
                        <td>Single-shot generation</td>
                        <td>Retry/repair with feedback</td>
                    </tr>
                </table>

                <h2>Final Summary</h2>
                <ol>
                    <li><strong>Be explicit</strong>: role, objective, constraints, format.</li>
                    <li><strong>Ground</strong> the model with real context (schema/docs).</li>
                    <li><strong>Constrain + validate</strong> outputs for production.</li>
                    <li><strong>Use repair loops</strong> with real errors for big gains.</li>
                </ol>
            </div>

            <div class="chapter-nav">
                <a href="comprehensive_chapter24.html">â† Previous Chapter</a>
                <a href="comprehensive_index.html">ğŸ  Home</a>
                <a href="comprehensive_chapter26.html">Next Chapter â†’</a>
            </div>
        </main>

        <footer class="footer">
            <p>Â© 2024 NL2SQL Project - Comprehensive LLM Learning Guide</p>
            <p>Chapter 25 of 26</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: { useMaxWidth: true, htmlLabels: true }
        });

        // Mobile menu toggle
        function toggleMobileMenu() {
            const nav = document.getElementById('nav-sidebar');
            if (nav) nav.classList.toggle('open');
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const nav = document.getElementById('nav-sidebar');
            const toggle = document.querySelector('.mobile-menu-toggle');

            if (nav && toggle &&
                !nav.contains(event.target) &&
                !toggle.contains(event.target) &&
                nav.classList.contains('open')) {
                nav.classList.remove('open');
            }
        });

        // Close mobile menu when clicking a link
        document.querySelectorAll('.nav-sidebar a').forEach(link => {
            link.addEventListener('click', function() {
                const nav = document.getElementById('nav-sidebar');
                if (nav && window.innerWidth <= 768) {
                    nav.classList.remove('open');
                }
            });
        });
    </script>
</body>
</html>

